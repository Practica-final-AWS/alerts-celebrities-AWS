<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Upload</title>
  <script src="https://cdn.tailwindcss.com"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {

  const uploadZone = document.getElementById('uploadZone');
  const fileInput = document.getElementById('fileInput');
  const gallery = document.getElementById('gallery');
  const imageGrid = document.getElementById('imageGrid');

  const PRESIGNED_API =
    "https://<api-id>.execute-api.us-east-1.amazonaws.com/Prod/presigned-url";

  // Drag & drop handlers
  uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadZone.classList.add('dragging');
  });

  uploadZone.addEventListener('dragleave', () => {
    uploadZone.classList.remove('dragging');
  });

  uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.classList.remove('dragging');
    handleFiles(e.dataTransfer.files);
  });

  fileInput.addEventListener('change', (e) => {
    handleFiles(e.target.files);
  });

  async function handleFiles(files) {
    for (const file of files) {
      if (!file.type.startsWith('image/')) continue;

      // Preview
      const reader = new FileReader();
      reader.onload = e => addImageToGallery(e.target.result, file.name);
      reader.readAsDataURL(file);

      try {
        // 1️⃣ Pedir URL prefirmada (Lambda Python)
        const res = await fetch(PRESIGNED_API, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            filename: file.name,
            contentType: file.type
          })
        });

        if (!res.ok) {
          const err = await res.json();
          throw new Error(err.error || "Error generando URL");
        }

        const { uploadUrl } = await res.json();

        // 2️⃣ Subir a S3
        const upload = await fetch(uploadUrl, {
          method: "PUT",
          body: file
        });

        if (!upload.ok) throw new Error("Error subiendo a S3");

        console.log(`✅ ${file.name} subida`);
      } catch (err) {
        console.error(err);
        alert(`❌ Error subiendo ${file.name}`);
      }
    }
  }

  function addImageToGallery(src, name) {
    gallery.classList.remove('hidden');

    const div = document.createElement('div');
    div.className =
      'relative aspect-square rounded-2xl overflow-hidden bg-slate-100 shadow-sm hover:shadow-xl transition-all duration-300 group';

    div.innerHTML = `
      <img src="${src}" alt="${name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
      <div class="absolute top-3 left-3">
        <div class="w-7 h-7 rounded-full bg-green-500 flex items-center justify-center shadow-lg">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </div>
      </div>
    `;
    imageGrid.appendChild(div);
  }

});
</script>


  <style>
    .upload-zone:hover { border-color: #818cf8; background-color: rgba(238, 242, 255, 0.3); }
    .upload-zone.dragging { border-color: #818cf8; background-color: rgba(238, 242, 255, 0.5); transform: scale(1.02); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-indigo-50/30">
  <div class="max-w-4xl mx-auto px-4 py-12 md:py-20">
    
    <!-- Header -->
    <div class="text-center mb-12">
      <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-violet-600 shadow-lg mb-6">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
        </svg>
      </div>
      <h1 class="text-4xl md:text-5xl font-light text-slate-900 tracking-tight mb-3">Image Upload</h1>
      <p class="text-slate-500 text-lg font-light">Drag and drop your images or click to browse</p>
    </div>
    <!-- Upload Zone -->
    <label id="uploadZone" class="upload-zone relative flex flex-col items-center justify-center w-full h-72 rounded-3xl border-2 border-dashed border-slate-200 bg-white/50 cursor-pointer transition-all duration-300">
      <input type="file" multiple accept="image/*" id="fileInput" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
      
      <div class="w-20 h-20 rounded-2xl bg-slate-100 flex items-center justify-center mb-6">
        <svg class="w-10 h-10 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
        </svg>
      </div>
      
      <p class="text-slate-600 font-medium mb-1">Drop images here</p>
      <p class="text-slate-400 text-sm">or click to browse from your device</p>
      
      <div class="flex items-center gap-2 mt-4 text-xs text-slate-400">
        <span class="px-2 py-1 rounded-full bg-slate-100">PNG</span>
        <span class="px-2 py-1 rounded-full bg-slate-100">JPG</span>
        <span class="px-2 py-1 rounded-full bg-slate-100">GIF</span>
        <span class="px-2 py-1 rounded-full bg-slate-100">WEBP</span>
      </div>
    </label>
    <!-- Gallery (initially hidden) -->
    <div id="gallery" class="mt-12 hidden">
      <h3 class="text-sm font-medium text-slate-500 uppercase tracking-wider mb-6">Uploaded Images</h3>
      <div id="imageGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
    </div>
  </div>
  <script>
    const uploadZone = document.getElementById('uploadZone');
    const fileInput = document.getElementById('fileInput');
    const gallery = document.getElementById('gallery');
    const imageGrid = document.getElementById('imageGrid');
    // Drag and drop handlers
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragging');
    });
    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragging');
    });
    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragging');
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });
    function handleFiles(files) {
      const BUCKET_NAME = 'celebrity-upload-498747779442 '; 
      const REGION = 'us-east-1';
      const IDENTITY_POOL_ID = 'us-east-1:498747779442';
      AWS.config.region = REGION;
      AWS.config.credentials = new AWS.CognitoIdentityCredentials({
          IdentityPoolId: IDENTITY_POOL_ID,
      });

      // 2. Locate your EXISTING function (e.g., the one that handles the drag/drop)
      function handleFileDrop(file) {
        
          // --- YOUR EXISTING CODE (Previews, animations, etc.) ---
          showPreview(file); 
          console.log("File received via drag and drop!");
          // ------------------------------------------------------

          // --- ADD THE AWS LOGIC HERE ---
          const s3 = new AWS.S3();
          s3.putObject({
              Bucket: BUCKET_NAME,
              Key: file.name,
              Body: file,
              ContentType: file.type
          }, (err, data) => {
              if (err) {
                  alert("Upload failed: " + err.message);
              } else {
                  alert("Success! Recognition is starting...");
              }
          });
    }
      Array.from(files).forEach(file => {
        if (!file.type.startsWith('image/')) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          addImageToGallery(e.target.result, file.name);
        };
        reader.readAsDataURL(file);
      });
    }
    function addImageToGallery(src, name) {
      gallery.classList.remove('hidden');
      
      const div = document.createElement('div');
      div.className = 'relative aspect-square rounded-2xl overflow-hidden bg-slate-100 shadow-sm hover:shadow-xl transition-all duration-300 group';
      div.innerHTML = `
        <img src="${src}" alt="${name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">
        <div class="absolute top-3 left-3">
          <div class="w-7 h-7 rounded-full bg-green-500 flex items-center justify-center shadow-lg">
            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          </div>
        </div>
      `;
      imageGrid.appendChild(div);
    }
  </script>
</body>
</html>